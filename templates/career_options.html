<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Options</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='career.css') }}">
</head>
<body>
    <div class="container">
        <h1 class="page-title">Career Options</h1>

        <div class="search-container">
            <div class="search-input-wrapper">
                <input type="text" id="career-search" placeholder="Type or speak to search...">
                <i class="fa-solid fa-magnifying-glass search-icon" id="search-icon" onclick="searchCareer()"></i>
                <i class="fa-solid fa-microphone voice-icon" id="voice-icon" onclick="startVoiceSearch()"></i>
            </div>
        </div>

        <div class="job-section">
            <h2 class="section-title today">Today's Jobs</h2>
            <div class="job-list">
                {% if todays_jobs %}
                    {% for job in todays_jobs %}
                        <div class="job-card">
                            <h3 class="job-title">{{ job['name'] }}</h3>
                            <p class="job-description">{{ job['description'] }}</p>
                            <p class="job-meta">
                                <strong>Location:</strong> 
                                {% if job['location'] %}
                                    <a href="https://maps.google.com/?q={{ job['location'] | urlencode }}" 
                                       target="_blank"
                                       class="map-link">
                                        {{ job['location'] }} <i class="fas fa-map-marker-alt"></i>
                                    </a>
                                {% else %}
                                    N/A
                                {% endif %}
                                | <strong>Vacancies:</strong> {{ job['total_labour_vacancy'] }}
                            </p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-jobs">No jobs posted today.</p>
                {% endif %}
            </div>
        </div>

        <div class="job-section">
            <h2 class="section-title all-jobs">All Available Jobs</h2>
            <div class="row"> 
                {% if jobs %}
                    {% for job in jobs %}
                        <div class="col-lg-4 col-md-6 col-12 mb-4">
                            <div class="career-card h-100"> 
                                <h3 class="card-title">{{ job.name }}</h3>
                                <p class="card-description"><strong>Description:</strong> {{ job.description }}</p>
                                <p class="job-meta">
                                    <strong>Location:</strong> 
                                    {% if job['location'] %}
                                        <a href="https://maps.google.com/?q={{ job['location'] | urlencode }}" 
                                           target="_blank"
                                           class="map-link">
                                            {{ job['location'] }} <i class="fas fa-map-marker-alt"></i>
                                        </a>
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </p>
                                <p class="skills-list"><strong>Skills Required:</strong>
                                    {% for skill in job.skills_required.split(',') %}
                                        {% if skill.strip() %}
                                            <span class="skill-item">{{ skill.strip() }}</span>
                                        {% endif %}
                                    {% endfor %}
                                </p>
                                <a href="{{ url_for('career_guidance', job_name=job.name) }}" class="career-link">Learn More about this career</a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="col-12">
                        <p class="no-jobs">No career options found. Try searching for something else.</p>
                    </div>
                {% endif %}
            </div>
        </div>
        <p class="back-to-home"><a href="/">Back to Home</a></p>
    </div>

    <div id="voiceFeedback" class="voice-feedback" style="display: none;">
        <i class="fas fa-microphone"></i>
        <p id="voiceStatus"></p> 
        <p id="voiceResult"></p>
    </div>

    <script>
        function searchCareer() {
            const searchInput = document.getElementById('career-search');
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = "{{ url_for('career_options') }}?query=" + encodeURIComponent(query);
            }
        }

        function startVoiceSearch() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                const recognition = new SpeechRecognition();
                const searchInput = document.getElementById('career-search');
                const voiceFeedback = document.getElementById('voiceFeedback');
                const voiceStatus = document.getElementById('voiceStatus');
                const voiceResult = document.getElementById('voiceResult');

                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    voiceStatus.textContent = 'Listening...';
                    voiceResult.textContent = '';
                    voiceFeedback.style.display = 'flex';
                };

                recognition.onend = function() {
                    setTimeout(() => {
                        voiceFeedback.style.display = 'none';
                    }, 1500);
                };

                recognition.onresult = function(event) {
                    const speechResult = event.results[0][0].transcript;
                    searchInput.value = speechResult;
                    voiceStatus.textContent = 'Result:';
                    voiceResult.textContent = `"${speechResult}"`;
                    
                    // Call the original search function after a short delay
                    setTimeout(searchCareer, 750);
                };

                recognition.onerror = function(event) {
                    voiceStatus.textContent = 'Error';
                    voiceResult.textContent = 'Try again.';
                    voiceIcon.classList.remove('blinking');
                    console.error('Speech recognition error:', event.error);
                };
                
                recognition.start();
            } else {
                alert('Web Speech API is not supported in this browser.');
            }
        }
    </script>
</body>
</html>