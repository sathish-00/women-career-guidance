<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Options</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='career.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<h1 style="font-family: Arial, sans-serif; color: #722c6e;">Career Options</h1>

<h2 style="color: #2980b9; border-bottom: 2px solid #2980b9; padding-bottom: 5px;">Today's Jobs</h2>
{% if todays_jobs %}
  <ul style="list-style: none; padding: 0;">
  {% for job in todays_jobs %}
    <li style="background: #f9f9f9; border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-bottom: 10px; font-family: Arial, sans-serif;">
      <strong style="color: #2980b9; font-size: 1.1em;">{{ job['name'] }}</strong>: {{ job['description'] }}<br />
      <em style="color: #7f8c8d;">Location:</em> {{ job['location'] or "N/A" }}, 
      <em style="color: #7f8c8d; margin-left: 10px;">Vacancies:</em> {{ job['total_labour_vacancy'] }}<br />
      <a href="{{ job['application_form_url'] or '#' }}" style="color: #2980b9; text-decoration: none; font-weight: bold;">Apply Here</a>
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p style="font-style: italic; color: #7f8c8d;">No jobs posted today.</p>
{% endif %}




    <div class="search-container">
        <div class="search-input-wrapper">
            <input type="text" id="career-search" placeholder="Type or speak to search...">
            <i class="fa-solid fa-magnifying-glass" id="search-icon" onclick="searchCareer()"></i>
            <i class="fa-solid fa-microphone" id="voice-icon" onclick="startVoiceSearch()"></i>
        </div>
    </div>
    <div style="text-align: center; margin-top: 30px;">
  <h2 style="color: #b99329; border-bottom: 2px solid #7fb929; padding-bottom: 5px; display: inline-block;">All Available Jobs</h2>
</div>

    <div class="career-container">
        <div class="career-grid">
            {% if jobs %}
                {% for job in jobs %}
                <div class="career-card">
                    <h2>{{ job.name }}</h2>
                    <p><strong>Description:</strong> {{ job.description }}</p>
                    <p class="skills-list">
                        <strong>Skills Required:</strong>
                        {% for skill in job.skills_required.split(',') %}
                            {% if skill.strip() %}
                                <span class="skill-item">
                                    {{ skill.strip() }}
                                    {% if skill.strip() in available_skills %}
                                        <a href="{{ available_skills[skill.strip()].reference }}" target="_blank" class="skill-link">(Learn More)</a>
                                    {% endif %}
                                </span>
                            {% endif %}
                        {% endfor %}
                    </p>
                </div>
                {% endfor %}
            {% else %}
                <p>No career options found. Try searching for something else.</p>
            {% endif %}
        </div>
        <p class="back-to-home"><a href="/">Back to Home</a></p>
    </div>
    
<!-- Render 'jobs' list here as you do currently -->



    <script>
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const voiceIcon = document.getElementById('voice-icon');
        const searchInput = document.getElementById('career-search');
        
        function searchCareer() {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = "{{ url_for('career_options') }}?query=" + encodeURIComponent(query);
            }
        }

        function startVoiceSearch() {
            if (SpeechRecognition) {
                const recognition = new SpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.start();
                voiceIcon.classList.add('blinking');

                recognition.onresult = function(event) {
                    const speechResult = event.results[0][0].transcript;
                    searchInput.value = speechResult;
                    searchCareer();
                };

                recognition.onend = function() {
                    voiceIcon.classList.remove('blinking');
                };

                recognition.onerror = function(event) {
                    voiceIcon.classList.remove('blinking');
                    console.error('Speech recognition error:', event.error);
                };
            } else {
                alert('Web Speech API is not supported in this browser. Please try Chrome or Edge.');
            }
        }
    </script>
</body>
</html>