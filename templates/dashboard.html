<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages" id="flash-messages">
        {% for category, message in messages %}
            <p class="flash {{ category }}">{{ message }}</p>
        {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<header class="menu-bar">
    <div class="menu-left">
        <span class="hamburger" onclick="toggleMenu()">&#9776;</span>
        <span class="welcome-message">Welcome, {{ user.username }}!</span>
    </div>

    <nav class="nav-links" id="navLinks">
        <a href="{{ url_for('home') }}" class="nav-button home-btn">Home</a>
        <button id="deleteAccountBtn" class="nav-button delete-btn">Delete Account</button>
        <a href="{{ url_for('logout') }}" class="nav-button logout-btn">Logout</a>
    </nav>
</header>

<div id="confirmDeleteModal" class="modal">
    <div class="modal-content">
        <p>Are you sure you want to permanently delete your account?</p>
        <form id="deleteAccountForm" action="{{ url_for('delete_account') }}" method="POST">
            <button type="submit" class="btn-confirm">Yes, Delete</button>
            <button type="button" id="cancelDeleteBtn" class="btn-cancel">Cancel</button>
        </form>
    </div>
</div>

<div class="dashboard-layout">
    <aside class="profile-summary">
        <h2>Your Profile</h2>
        {% if user %}
            <div class="profile-details">
                <p><strong>Username:</strong> <span>{{ user.username }}</span></p>
                <p><strong>Age:</strong> <span>{{ user.age }}</span></p>
                <p><strong>Skills:</strong> <span>{{ user.skills | default('None specified') }}</span></p>
            </div>
            <div class="profile-pic-wrapper">
                {% if user.profile_pic %}
                    <img src="{{ url_for('static', filename='profile_pics/' + user.profile_pic) }}" alt="Profile Picture" class="profile-pic" id="profilePic" style="cursor: pointer;" title="Click to view full size" />
                {% else %}
                    <img src="{{ url_for('static', filename='default_profile.png') }}" alt="Default Profile Picture" class="profile-pic default" />
                {% endif %}
            </div>
            <a href="{{ url_for('edit_profile') }}" class="button edit-button">Edit Profile</a>
        {% else %}
            <p>Profile information not available.</p>
        {% endif %}

        <section class="applied-jobs-summary">
            <h2>Jobs You've Applied For</h2>
            {% if applied_jobs %}
                <ul class="applied-jobs-list">
                    {% for job in applied_jobs %}
                        <li>
                            <span class="job-name">{{ job.job_name }}</span>
                            <a href="{{ url_for('download_application', application_id=job.application_id) }}" class="download-link">Download PDF</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You have not applied for any jobs yet.</p>
            {% endif %}
        </section>
    </aside>

    <div id="picModal" class="modal">
        <span class="close-modal" id="closeModal">&times;</span>
        <img class="modal-content" id="modalImage" />
    </div>

    <main class="main-content">
        <section class="career-suggestions">
            <h3>Vacant Jobs Based on Your Skills</h3>
            <div class="career-cards-container">
                {% if jobs %}
                    {% for job in jobs %}
                        <div class="job-posting">
                            <h4 class="job-name-heading">Job Name : {{ job.name }}</h4>
                            <p><strong>Shop Name / Company Name :</strong> {{ job.shop_name or "N/A" }}</p>
                            <p><strong>Location:</strong> {{ job.location or "N/A" }}</p>
                            <p><strong>Contact Info:</strong> {{ job.contact_info or "N/A" }}</p>
                            <p><strong>Description:</strong> {{ job.description }}</p>
                            <div class="job-status">
                                {% if job.is_vacant == 1 %}
                                    <span class="status-badge vacant">Vacancy Available</span>
                                    <a href="{{ url_for('apply', job_id=job.id) }}" class="apply-button btn btn-primary">Apply Now üìù</a>
                                {% else %}
                                    <span class="status-badge no-vacant">No Vacancy</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No relevant job postings found based on your skills.</p>
                {% endif %}
            </div>
        </section>

        <section class="quick-links">
            <h3>Quick Links</h3>
            <div class="links-grid">
                <a href="{{ url_for('career_interests') }}" class="quick-link-card">
                    <h4>Explore All Careers</h4>
                    <p>Browse a comprehensive list of career opportunities.</p>
                </a>
                <a href="{{ url_for('contact') }}" class="quick-link-card">
                    <h4>Contact Us</h4>
                    <p>Get in touch for personalized guidance.</p>
                </a>
            </div>
        </section>
    </main>
</div>

<script>
    // --- Menu toggle for mobile ---
    function toggleMenu() {
        const nav = document.getElementById('navLinks');
        nav.classList.toggle('show');
    }

    // --- All Modal Logic in one place ---
    document.addEventListener('DOMContentLoaded', function() {
        // Profile picture modal elements
        const picModal = document.getElementById('picModal');
        const profilePic = document.getElementById('profilePic');
        const modalImage = document.getElementById('modalImage');
        const closeModalBtn = document.getElementById('closeModal');

        if (profilePic) {
            profilePic.onclick = function() {
                picModal.style.display = "flex"; // Use flex to center content
                modalImage.src = this.src;
            }
        }
        if (closeModalBtn) {
            closeModalBtn.onclick = function() {
                picModal.style.display = "none";
            }
        }

        // Delete confirmation modal elements
        const confirmDeleteModal = document.getElementById('confirmDeleteModal');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        
        if (deleteAccountBtn) {
            deleteAccountBtn.addEventListener('click', () => {
                confirmDeleteModal.style.display = 'flex'; // Use flex to center
            });
        }
        if (cancelDeleteBtn) {
            cancelDeleteBtn.addEventListener('click', () => {
                confirmDeleteModal.style.display = 'none';
            });
        }

        // Close modals if user clicks outside the content
        window.addEventListener('click', (event) => {
            if (event.target === picModal) {
                picModal.style.display = "none";
            }
            if (event.target === confirmDeleteModal) {
                confirmDeleteModal.style.display = 'none';
            }
        });

        // --- Flash message auto-hide ---
        const flashMessagesContainer = document.getElementById('flash-messages');
        if (flashMessagesContainer) {
            setTimeout(() => {
                flashMessagesContainer.style.transition = 'opacity 0.5s ease';
                flashMessagesContainer.style.opacity = '0';
                setTimeout(() => {
                    flashMessagesContainer.remove();
                }, 500); // Wait for fade out to complete
            }, 3000); // Message visible for 3 seconds
        }
    });
</script>

</body>
</html>